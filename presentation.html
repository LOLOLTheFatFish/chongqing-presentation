<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPT Presentation Viewer with Audio</title>
    <style>
        :root {
            --text-color: #111111;
            --secondary-text: #666666;
            --bg-color: #ffffff;
            --light-bg: #f8f8f8;
            --dark-bg: #111111;
            --border-color: #e0e0e0;
            --hover-color: #f0f0f0;
            --active-color: #000000;
            --shadow: 0 1px 2px rgba(0, 0, 0, 0.05), 0 1px 4px rgba(0, 0, 0, 0.05), 0 2px 8px rgba(0, 0, 0, 0.05);
            --btn-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --card-radius: 4px;
            --btn-radius: 4px;
            
            /* Audio controls colors */
            --audio-primary: #003366;
            --audio-accent: #FFCC00;
            --audio-bg: #1a1a1a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background-color: var(--dark-bg);
            color: white;
            margin-bottom: 32px;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .view-controls {
            display: flex;
            gap: 8px;
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: var(--btn-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .view-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .view-btn.active {
            background-color: var(--audio-accent);
            color: var(--audio-primary);
        }

        .start-button {
            padding: 12px 24px;
            background-color: var(--audio-accent);
            color: var(--audio-primary);
            border: none;
            border-radius: var(--btn-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: var(--btn-shadow);
            transition: all 0.2s ease;
            margin-bottom: 24px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .start-button:hover {
            background-color: #e6b800;
            transform: translateY(-1px);
        }

        /* Preview containers */
        .preview-container {
            display: grid;
            gap: 24px;
        }

        .preview-container.grid-view {
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        }

        .preview-container.list-view {
            grid-template-columns: 1fr;
        }

        .slide-preview {
            background-color: var(--bg-color);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .slide-preview:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .slide-preview.active {
            border: 2px solid var(--audio-accent);
        }

        .slide-number {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }

        .slide-frame-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

        .slide-frame {
            width: 100%;
            height: 100%;
            border: none;
            transform-origin: top left;
        }

        /* Presentation mode */
        .presentation-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .presentation-slide {
            width: 1280px;
            height: 720px;
            border: none;
            transform-origin: center center;
        }

        .presentation-slide-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            width: 100%;
            padding: 20px;
        }

        /* Unified Controls */
        .unified-controls {
            height: 80px;
            background-color: var(--audio-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            padding: 0 24px;
            position: relative;
            z-index: 1001;
        }

        .unified-controls.fullscreen {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .unified-controls.fullscreen:hover,
        .unified-controls.fullscreen.show {
            opacity: 1;
        }

        .audio-controls-section {
            display: flex;
            align-items: center;
            gap: 20px;
            min-width: 350px;
        }

        .ppt-controls-section {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
            justify-content: center;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            position: absolute;
            bottom: 8px;
            right: 24px;
        }

        .play-pause-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--audio-accent);
            border: none;
            color: var(--audio-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .play-pause-btn:hover {
            background-color: #e6b800;
            transform: scale(1.05);
        }

        .audio-progress {
            flex: 1;
            max-width: 280px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            margin: 0 20px;
        }

        .audio-progress-fill {
            height: 100%;
            background-color: var(--audio-accent);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .audio-time {
            color: white;
            font-size: 14px;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
            flex-shrink: 0;
        }

        /* Subtitle Controls */
        .subtitle-controls {
            position: absolute;
            top: 16px;
            right: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1002;
        }

        .subtitle-toggle {
            padding: 6px 12px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .subtitle-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .subtitle-toggle.active {
            background-color: var(--audio-accent);
            color: var(--audio-primary);
        }

        /* Subtitle Display - Improved */
        .subtitle-container {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            max-width: 85%;
            text-align: center;
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s ease;
            pointer-events: none;
        }

        .subtitle-container.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        .subtitle-text {
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.4;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);
            margin-bottom: 6px;
            backdrop-filter: blur(3px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .subtitle-text.english {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .subtitle-text.chinese {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 400;
        }

        /* Fade out animation */
        .subtitle-container.fade-out {
            opacity: 0;
            transform: translateX(-50%) translateY(5px);
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .speed-btn {
            padding: 6px 12px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .speed-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .speed-btn.active {
            background-color: var(--audio-accent);
            color: var(--audio-primary);
        }



        .progress-bar {
            flex: 1;
            max-width: 300px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 0 20px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--audio-accent);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .slide-indicators {
            color: white;
            font-size: 14px;
            font-weight: 500;
            min-width: 80px;
            text-align: center;
            flex-shrink: 0;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: none;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: var(--btn-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }

        .control-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Audio indicator */
        .audio-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: var(--audio-accent);
            color: var(--audio-primary);
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: 600;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .audio-indicator.playing {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .audio-indicator svg {
            width: 8px;
            height: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .preview-container.grid-view {
                grid-template-columns: 1fr;
            }
            
            .unified-controls {
                height: auto;
                flex-direction: column;
                padding: 16px;
                gap: 12px;
            }
            
            .audio-controls-section {
                min-width: auto;
                gap: 16px;
            }
            
            .audio-progress {
                max-width: none;
                margin: 0 10px;
            }
            
            .ppt-controls-section {
                gap: 12px;
            }
            
            .speed-control {
                position: static;
                flex-wrap: wrap;
                gap: 4px;
                justify-content: center;
            }
            
            .speed-btn {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            /* Mobile subtitle optimizations */
            .subtitle-controls {
                top: 8px;
                right: 16px;
            }
            
            .subtitle-toggle {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .subtitle-container {
                bottom: 120px;
                max-width: 90%;
            }
            
            .subtitle-text {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            .subtitle-text.english {
                font-size: 15px;
            }
            
            .subtitle-text.chinese {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chongqing: From Wanghong to Changhong</h1>
            <div class="view-controls">
                <button id="grid-view-btn" class="view-btn">Grid View</button>
                <button id="list-view-btn" class="view-btn active">List View</button>
            </div>
        </header>

        <button id="play-button" class="start-button">ðŸŽ¯ Auto Play Presentation</button>

        <div id="preview-container" class="preview-container list-view">
            <!-- Slide previews will be generated here -->
        </div>
    </div>

    <!-- Presentation Mode -->
    <div id="presentation-mode" class="presentation-mode">
        <div class="presentation-slide-container">
            <iframe id="presentation-slide" class="presentation-slide" frameborder="0"></iframe>
            
            <!-- Subtitle Controls -->
            <div class="subtitle-controls">
                <button id="subtitle-toggle" class="subtitle-toggle">ðŸŽ¬ Subtitles</button>
            </div>
            
            <!-- Subtitle Display -->
            <div id="subtitle-container" class="subtitle-container">
                <div id="subtitle-english" class="subtitle-text english"></div>
                <div id="subtitle-chinese" class="subtitle-text chinese"></div>
            </div>
        </div>
        
        <!-- Unified Controls -->
        <div id="unified-controls" class="unified-controls">
            <!-- Audio Controls (Left) -->
            <div class="audio-controls-section">
                <button id="play-pause-btn" class="play-pause-btn">â–¶</button>
                <div class="audio-progress" id="audio-progress">
                    <div class="audio-progress-fill" id="audio-progress-fill"></div>
                </div>
                <div class="audio-time">
                    <span id="audio-current-time">0:00</span> / <span id="audio-duration">0:00</span>
                </div>
            </div>
            
            <!-- PPT Controls (Right) -->
            <div class="ppt-controls-section">
                <button id="prev-slide" class="control-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="slide-indicators">
                    <span id="current-slide">1</span>/<span id="total-slides">22</span>
                </div>
                <button id="next-slide" class="control-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
                <button id="fullscreen-toggle" class="control-btn" title="Toggle Fullscreen">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
                <button id="exit-presentation" class="control-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Speed Control (Bottom Right) -->
            <div class="speed-control">
                <span style="color: white; font-size: 12px; margin-right: 8px;">Speed:</span>
                <button class="speed-btn" data-speed="0.5">0.5x</button>
                <button class="speed-btn active" data-speed="1">1x</button>
                <button class="speed-btn" data-speed="1.25">1.25x</button>
                <button class="speed-btn" data-speed="1.5">1.5x</button>
                <button class="speed-btn" data-speed="2">2x</button>
            </div>
        </div>
    </div>

    <script>
        // Load precise subtitle data
        const script = document.createElement('script');
        script.src = 'subtitles/precise-subtitle-data.js';
        document.head.appendChild(script);
        
        // Global reference for precise subtitle data
        window.preciseSubtitleData = null;
        
        // Fallback subtitle data if file loading fails
        const subtitleData = [
          {
            slide: 1,
            english: "So let's talk about Chongqing. You've probably seen it. It's that mind-bending Chinese megacity that just completely took over the internet. You know, the 8D Magic city with buildings you can drive a train through. And that famously spicy hot pot that absolutely nailed going viral. But all of this success brings up one really, really important question.",
            chinese: "é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥èŠèŠé‡åº†ã€‚ä½ å¾ˆå¯èƒ½å·²ç»è§è¿‡äº†ã€‚å°±æ˜¯é‚£åº§ä»¤äººåŒªå¤·å¤·çš„ä¸­å›½ç‰¹å¤§åŸŽå¸‚ï¼Œå®ƒç®€ç›´åˆ·çˆ†äº†å…¨ç½‘ã€‚ä½ çŸ¥é“çš„ï¼Œå°±æ˜¯é‚£åº§8Dé­”å¹»ä¹‹éƒ½ï¼Œè½»è½¨å¯ä»¥ä»Žå¤§æ¥¼é‡Œç©¿è¿‡ã€‚è¿˜æœ‰é‚£è‘—åçš„éº»è¾£ç«é”…ï¼Œä»–ä»¬ä¹ŸæˆåŠŸåœ°è®©å®ƒç«å‡ºäº†åœˆã€‚ä½†æ‰€æœ‰è¿™äº›æˆåŠŸä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªéžå¸¸éžå¸¸é‡è¦çš„é—®é¢˜ã€‚"
          },
          {
            slide: 2,
            english: "Right? It sounds like a great problem to have, but it can be a total trap. How do you actually convert all that temporary algorithm-driven hype into something that lasts? You know, how do you make sure your city isn't just a one-hit wonder?",
            chinese: "å¯¹å§ï¼Ÿè¿™å¬èµ·æ¥åƒæ˜¯ä¸ªç”œèœœçš„çƒ¦æ¼ï¼Œä½†å®ƒä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå½»å¤´å½»å°¾çš„é™·é˜±ã€‚ä½ åˆ°åº•è¯¥å¦‚ä½•æŠŠæ‰€æœ‰è¿™äº›ç”±ç®—æ³•é©±åŠ¨çš„æš‚æ—¶çƒ­åº¦ï¼Œè½¬åŒ–ä¸ºèƒ½æŒä¹…çš„ä¸œè¥¿å‘¢ï¼Ÿä½ æ‡‚çš„ï¼Œä½ å¦‚ä½•ç¡®ä¿ä½ çš„åŸŽå¸‚ä¸åªæ˜¯ä¸€ä¸ªæ˜™èŠ±ä¸€çŽ°çš„ç½‘çº¢ï¼Ÿ"
          },
          {
            slide: 3,
            english: "And you know, the analysis we're digging into today just nails this. The whole challenge is about moving from being Wang Hong, which means internet famous, super trendy, but can disappear in a flash, to being Chang Hong, which is like evergreen. Think classic, timeless, something people always want to visit. So the billion-dollar question is, how on earth do you make that jump?",
            chinese: "ä½ çŸ¥é“ï¼Œæˆ‘ä»¬ä»Šå¤©æ·±å…¥ç ”ç©¶çš„è¿™ä»½åˆ†æžæŠ¥å‘Šæ­£å¥½æŠ“ä½äº†è¿™ä¸€ç‚¹ã€‚æ•´ä¸ªæŒ‘æˆ˜çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ä»Žç½‘çº¢ï¼Œæ„æ€æ˜¯ç½‘ç»œçŸ¥ååº¦é«˜ã€è¶…çº§æ–°æ½®ï¼Œä½†å¯èƒ½çž¬é—´æ¶ˆå¤±ï¼Œè½¬å˜ä¸ºé•¿çº¢ï¼Œä¹Ÿå°±æ˜¯å¸¸é’æ ‘ã€‚æƒ³è±¡ä¸€ä¸‹ç»å…¸ã€æ°¸æ’ï¼Œæ˜¯é‚£ç§äººä»¬æ€»æƒ³åŽ»å‚è§‚çš„åœ°æ–¹ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªä»·å€¼åƒé‡‘çš„é—®é¢˜å°±æ˜¯ï¼Œä½ åˆ°åº•è¦æ€Žæ ·æ‰èƒ½å®žçŽ°è¿™ä¸ªè·³è·ƒå‘¢ï¼Ÿ"
          },
          {
            slide: 4,
            english: "And trust me, the stakes are unbelievably high. This isn't just about getting likes on a video. Take a look at that number. That's over 500 billion yuan. That's the city's domestic tourism revenue for 2024. We are talking about a gigantic economic engine that they have to keep running smoothly.",
            chinese: "ç›¸ä¿¡æˆ‘ï¼Œè¿™å…¶ä¸­çš„åˆ©å®³å…³ç³»é«˜å¾—ä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸ºäº†åœ¨è§†é¢‘ä¸ŠèŽ·å¾—ç‚¹èµžã€‚çœ‹çœ‹é‚£ä¸ªæ•°å­—ã€‚é‚£æ˜¯è¶…è¿‡5ä¸‡äº¿äººæ°‘å¸ã€‚è¿™æ˜¯è¯¥å¸‚2024å¹´çš„å›½å†…æ—…æ¸¸æ”¶å…¥ã€‚æˆ‘ä»¬è°ˆè®ºçš„æ˜¯ä¸€ä¸ªä»–ä»¬å¿…é¡»ä¿æŒå¹³ç¨³è¿è¡Œçš„åºžå¤§ç»æµŽå¼•æ“Žã€‚"
          },
          {
            slide: 5,
            english: "And this brings us right to the heart of the problem, what we can call the fame trap, because Chongqing's wild success is also its biggest weakness. It is the definition of a double-edged sword.",
            chinese: "è¿™å°±æŠŠæˆ‘ä»¬å¸¦åˆ°äº†é—®é¢˜çš„æ ¸å¿ƒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å£°åé™·é˜±ï¼Œå› ä¸ºé‡åº†çš„å·¨å¤§æˆåŠŸåŒæ—¶ä¹Ÿæ˜¯å®ƒæœ€å¤§çš„å¼±ç‚¹ã€‚è¿™æ­£æ˜¯åŒåˆƒå‰‘è¿™ä¸ªè¯çš„å®Œç¾Žå®šä¹‰ã€‚"
          },
          {
            slide: 6,
            english: "So the analysis breaks it down into two major threats. First, the city is way too reliant on that internet famous label, you know how it is, trends change, what looks amazing and futuristic one day can feel kind of played out the next, people get tired of seeing the same thing. And second, the competition is just insane in China's travel market, some other city is always just one viral video away from becoming the new 'it' spot.",
            chinese: "æ‰€ä»¥ï¼Œè¿™ä»½åˆ†æžå°†å…¶åˆ†è§£ä¸ºä¸¤å¤§ä¸»è¦å¨èƒã€‚é¦–å…ˆï¼Œè¿™åº§åŸŽå¸‚è¿‡åˆ†ä¾èµ–é‚£ä¸ªç½‘çº¢æ ‡ç­¾äº†ï¼Œä½ ä¹ŸçŸ¥é“æƒ…å†µå°±æ˜¯è¿™æ ·ï¼Œæ½®æµæ€»æ˜¯åœ¨å˜ã€‚ä»Šå¤©çœ‹èµ·æ¥å¾ˆç¥žå¥‡ã€å¾ˆæœªæ¥çš„ä¸œè¥¿ï¼Œæ˜Žå¤©å¯èƒ½å°±è®©äººè§‰å¾—æœ‰ç‚¹è€å¥—äº†ï¼Œäººä»¬ä¼šåŽŒå€¦çœ‹åŒæ ·çš„ä¸œè¥¿ã€‚å…¶æ¬¡ï¼Œä¸­å›½æ—…æ¸¸å¸‚åœºçš„ç«žäº‰ç®€ç›´åˆ°äº†ç–¯ç‹‚çš„åœ°æ­¥ï¼Œå…¶ä»–åŸŽå¸‚æ€»æ˜¯ç¦»æˆä¸ºä¸‹ä¸€ä¸ªçˆ†æ¬¾æ‰“å¡åœ°åªæœ‰ä¸€æ”¯ç—…æ¯’è§†é¢‘çš„è·ç¦»ã€‚"
          },
          {
            slide: 7,
            english: "And this quote just says it all, doesn't it? In the age of short-form video the bar for becoming an internet famous city is almost non-existent, any city with a cool gimmick can suddenly steal the spotlight, which makes that viral fame model super, super unstable.",
            chinese: "è€Œè¿™å¥è¯ç®€ç›´è¯´æ˜Žäº†ä¸€åˆ‡ï¼Œä¸æ˜¯å—ï¼Ÿåœ¨è¿™ä¸ªçŸ­è§†é¢‘æ—¶ä»£ï¼Œæˆä¸ºä¸€ä¸ªç½‘çº¢åŸŽå¸‚çš„é—¨æ§›å‡ ä¹Žä¸å­˜åœ¨ï¼Œä»»ä½•ä¸€ä¸ªæœ‰ç‚¹é…·çš„å™±å¤´çš„åŸŽå¸‚éƒ½å¯ä»¥çªç„¶æŠ¢èµ°èšå…‰ç¯ï¼Œè¿™ä½¿å¾—é‚£ç§ç—…æ¯’å¼æˆåæ¨¡å¼å˜å¾—è¶…çº§ã€è¶…çº§ä¸ç¨³å®šã€‚"
          },
          {
            slide: 8,
            english: "Okay, so before we get into the fix, let's just quickly look at how Chongqing even pulled this off. I mean, this didn't just happen by accident, it was really a perfect storm of the right factors coming together at the right time.",
            chinese: "å¥½äº†ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬æ·±å…¥æŽ¢è®¨è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¿«é€Ÿå›žé¡¾ä¸€ä¸‹é‡åº†å½“åˆåˆ°åº•æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼Œè¿™ç»éžå¶ç„¶ï¼Œå®ƒå®žé™…ä¸Šæ˜¯å¤šç§æ­£ç¡®å› ç´ åœ¨æ­£ç¡®çš„æ—¶é—´æ±‡é›†åˆ°ä¸€èµ·æ‰€å½¢æˆçš„å®Œç¾Žé£Žæš´ã€‚"
          },
          {
            slide: 9,
            english: "So you've got these four pillars holding it all up. Politically you have the government pushing for integration with its neighbor Sichuan. Economically, people just had more money to spend, especially after the pandemic, creating this huge travel boom. Socially, the city was smart, It jumped on new trends like City Walk instead of just pushing the same old sites. And finally, technology, a massive upgrade in transportation is making it easier than ever to get in and out. But this very success story was pointing towards something else.",
            chinese: "æœ‰è¿™å››å¤§æ”¯æŸ±åœ¨æ”¯æ’‘ç€è¿™ä¸€åˆ‡ã€‚æ”¿æ²»ä¸Šï¼Œä½ æœ‰æ”¿åºœåœ¨æŽ¨åŠ¨ä¸Žé‚»çœå››å·çš„ä¸€ä½“åŒ–å‘å±•ã€‚ç»æµŽä¸Šï¼Œäººä»¬æ‰‹å¤´æœ‰äº†æ›´å¤šçš„é’±å¯ä»¥æ¶ˆè´¹ï¼Œå°¤å…¶æ˜¯åœ¨ç–«æƒ…ä¹‹åŽï¼Œè¿™å‚¬ç”Ÿäº†å·¨å¤§çš„æ—…æ¸¸çƒ­æ½®ã€‚ç¤¾ä¼šå±‚é¢ï¼Œè¿™åº§åŸŽå¸‚å¾ˆèªæ˜Žï¼Œå®ƒè¿…é€ŸæŠ“ä½äº†åƒåŸŽå¸‚æ¼«æ­¥è¿™æ ·çš„æ–°æ½®æµï¼Œè€Œä¸æ˜¯ä¸€å‘³åœ°æŽ¨å¹¿é‚£äº›è€æŽ‰ç‰™çš„æ™¯ç‚¹ã€‚æœ€åŽæ˜¯æŠ€æœ¯å±‚é¢ï¼Œäº¤é€šè¿è¾“çš„å·¨å¤§å‡çº§ä½¿å¾—è¿›å‡ºé‡åº†å˜å¾—å‰æ‰€æœªæœ‰çš„å®¹æ˜“ã€‚ä½†æ­£æ˜¯è¿™ä¸ªæˆåŠŸæ•…äº‹æœ¬èº«ï¼Œä¹Ÿæ­£æŒ‡å‘äº†åˆ«çš„ä¸œè¥¿ã€‚"
          },
          {
            slide: 10,
            english: "Yeah, all of those things created this incredible boom in domestic travel, but it was kind of like a massive spotlight that didn't just illuminate the success, it also cast a shadow revealing this huge untapped market just sitting there waiting.",
            chinese: "æ˜¯çš„ï¼Œæ‰€æœ‰è¿™äº›å› ç´ å…±åŒé€ å°±äº†å›½å†…æ—…æ¸¸ä¸šçš„æƒŠäººç¹è£ï¼Œä½†è¿™åˆæœ‰ç‚¹åƒä¸€æŸå·¨å¤§çš„èšå…‰ç¯ï¼Œå®ƒä¸ä»…ç…§äº®äº†æˆåŠŸï¼Œä¹ŸæŠ•ä¸‹äº†ä¸€ç‰‡é˜´å½±ï¼Œåœ¨è¿™ç‰‡é˜´å½±ä¸­æ˜¾çŽ°å‡ºäº†ä¸€ä¸ªå·¨å¤§çš„ã€å°šæœªå¼€å‘çš„å¸‚åœºï¼Œæ­£é™é™åœ°ç­‰åœ¨é‚£é‡Œã€‚"
          },
          {
            slide: 11,
            english: "And here it is, wow, while everyone was laser focused on the domestic tourists, look at this, a more than 183% jump in international arrivals in 2024. That is not just a little bump. That is a massive signal that there's a whole new engine for growth just waiting to be fired up.",
            chinese: "ç­”æ¡ˆæ­æ™“äº†ï¼Œå“‡å“¦ï¼å°±åœ¨æ‰€æœ‰äººéƒ½æ¿€å…‰èšç„¦åœ¨å›½å†…æ¸¸å®¢èº«ä¸Šæ—¶ï¼Œå¿«çœ‹è¿™ä¸ªâ€”â€”2024å¹´çš„å›½é™…å…¥å¢ƒæ¸¸å®¢æ•°é‡å¢žé•¿äº†è¶…è¿‡183%ï¼è¿™å¯ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå°å°çš„æ³¢åŠ¨ã€‚è¿™æ˜¯ä¸€ä¸ªæžå…¶å¼ºçƒˆçš„ä¿¡å·ï¼Œè¡¨æ˜Žæœ‰ä¸€ä¸ªå…¨æ–°çš„å¢žé•¿å¼•æ“Žæ­£ç­‰å¾…ç€è¢«ç‚¹ç‡ƒã€‚"
          },
          {
            slide: 12,
            english: "Okay, so that leads us to the solution, tapping into that huge international opportunity is the key to chongqing's whole strategic playbook. It's a four-part plan to turn it from a viral hit into a truly evergreen destination.",
            chinese: "å¥½çš„ï¼Œè¿™å°±å¼•å¯¼æˆ‘ä»¬æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚å¼€æ‹“é‚£ä¸ªå·¨å¤§çš„å›½é™…æœºé‡ï¼Œå°±æ˜¯é‡åº†æ•´ä¸ªæˆ˜ç•¥æ‰‹å†Œçš„å…³é”®æ‰€åœ¨ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†ä¸ºå››éƒ¨åˆ†çš„è®¡åˆ’ï¼Œæ—¨åœ¨å°†å…¶ä»Žä¸€ä¸ªç—…æ¯’å¼çˆ†æ¬¾è½¬å˜ä¸ºä¸€ä¸ªçœŸæ­£çš„å¸¸é’æ ‘æ—…æ¸¸åœ°ã€‚"
          },
          {
            slide: 13,
            english: "The first move is pure offense. It's the SO strategy, that just means using your inherent strengths to seize outside opportunities. The big idea here is to leverage what Chongqing is already good at, like its unique culture and all that government support, to grab the huge opportunity of a unified market with its neighbor SiChuan. Basically, stop competing and start working together.",
            chinese: "ç¬¬ä¸€ä¸ªè¡ŒåŠ¨æ˜¯çº¯ç²¹çš„è¿›æ”»ã€‚è¿™å°±æ˜¯SOç­–ç•¥ã€‚æ„æ€å°±æ˜¯åˆ©ç”¨ä½ çš„å†…åœ¨ä¼˜åŠ¿åŽ»æŠ“ä½å¤–éƒ¨æœºé‡ã€‚è¿™é‡Œçš„æ ¸å¿ƒæž„æƒ³æ˜¯æ æ†åŒ–é‡åº†å·²ç»æ“…é•¿çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å®ƒç‹¬ç‰¹çš„æ–‡åŒ–å’Œæ‰€æœ‰çš„é‚£äº›æ”¿åºœæ”¯æŒï¼ŒåŽ»æŠ“ä½ä¸Žé‚»çœå››å·å½¢æˆç»Ÿä¸€å¸‚åœºçš„å·¨å¤§æœºé‡ã€‚åŸºæœ¬ä¸Šå°±æ˜¯åœæ­¢ç«žäº‰ï¼Œå¼€å§‹åˆä½œã€‚"
          },
          {
            slide: 14,
            english: "So what does that actually look like? Well, for starters, you create travel packages that cover both regions built around shared history, and here's the kicker, you market it to the world as one powerful brand, the bashu region, making the entire area a must-see, not just one city.",
            chinese: "é‚£ä¹ˆï¼Œè¿™å…·ä½“çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå—¯ï¼Œé¦–å…ˆï¼Œä½ åˆ›å»ºè¦†ç›–ä¸¤ä¸ªåœ°åŒºçš„æ—…æ¸¸å¥—é¤ï¼Œè¿™äº›å¥—é¤è¦å›´ç»•ç€å…±åŒçš„åŽ†å²æ¥æ‰“é€ ã€‚ç„¶åŽï¼Œé‡å¤´æˆæ¥äº†ï¼šä½ æŠŠå®ƒä½œä¸ºä¸€ä¸ªç»Ÿä¸€çš„å¼ºå¤§å“ç‰Œâ€”â€”å·´èœ€åœ°åŒºâ€”â€”å‘å…¨ä¸–ç•ŒæŽ¨å¹¿ï¼Œè®©æ•´ä¸ªåŒºåŸŸæˆä¸ºä¸€ä¸ªå¿…çœ‹ä¹‹åœ°ï¼Œè€Œä¸ä»…ä»…æ˜¯ï¼ˆé‡åº†ï¼‰ä¸€åº§åŸŽå¸‚ã€‚"
          },
          {
            slide: 15,
            english: "Alright, next up is the WO strategy. Think of this as a turnaround play, you're tackling your internal weaknesses by taking advantage of external opportunities. The weakness? Chongqing is way too dependent on online travel agencies and can get super overcrowded. The opportunity? Tourists are now demanding higher quality, unique experiences.",
            chinese: "å¥½äº†ï¼ŒæŽ¥ä¸‹æ¥æ˜¯WOç­–ç•¥ã€‚ä½ å¯ä»¥æŠŠè¿™çœ‹ä½œä¸€ä¸ªæ‰­è½¬æˆ˜ï¼Œä½ é€šè¿‡åˆ©ç”¨å¤–éƒ¨æœºé‡æ¥è§£å†³ä½ çš„å†…éƒ¨å¼±ç‚¹ã€‚å¼±ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿé‡åº†è¿‡åˆ†ä¾èµ–åœ¨çº¿æ—…è¡Œç¤¾ï¼Œè€Œä¸”å¯èƒ½ä¼šå˜å¾—è¶…çº§æ‹¥æŒ¤ã€‚æœºé‡æ˜¯ä»€ä¹ˆï¼Ÿæ¸¸å®¢çŽ°åœ¨è¦æ±‚çš„æ˜¯æ›´é«˜è´¨é‡ã€æ›´ç‹¬ç‰¹çš„ä½“éªŒã€‚"
          },
          {
            slide: 16,
            english: "So this is all about taking back control. You beef up the city's official app with exclusive deals on local stuff you can't get anywhere else, that pulls people away from the giant travel platforms, and you use data to actually manage the crowds, guiding people to cool new neighborhoods instead of letting everyone pile into the same three tourist traps.",
            chinese: "æ‰€ä»¥ï¼Œè¿™ä¸€æ‹›çš„æ ¸å¿ƒå°±æ˜¯å¤ºå›žæŽ§åˆ¶æƒã€‚ä½ å¾—å¼ºåŒ–åŸŽå¸‚çš„å®˜æ–¹APPï¼Œç”¨é‚£äº›ä½ åœ¨åˆ«å¤„æ ¹æœ¬æ‹¿ä¸åˆ°çš„ç‹¬å®¶ä¼˜æƒ å’Œæœ¬åœ°ç‰¹è‰²äº§å“ï¼ŒæŠŠäººä»¬ä»Žé‚£äº›å·¨å¤´æ—…æ¸¸å¹³å°ä¸Šæ‹‰å¼€ã€‚åŒæ—¶ï¼Œä½ åˆ©ç”¨æ•°æ®æ¥çœŸæ­£åœ°ç®¡ç†äººç¾¤ï¼Œå¼•å¯¼äººä»¬åŽ»é‚£äº›å¾ˆé…·çš„æ–°è¡—åŒºï¼Œè€Œä¸æ˜¯è®©æ‰€æœ‰äººéƒ½æŒ¤è¿›é‚£å‡ ä¸ªè€ä¸€å¥—çš„æ¸¸å®¢é™·é˜±é‡Œã€‚"
          },
          {
            slide: 17,
            english: "Path number 3 is all about defense. This is the ST strategy, which means using your unique strengths to neutralize those outside threats. It's about building a competitive moat around your city. How do you stop other places from copying you? You double down on the things that are impossible to replicate.",
            chinese: "ç¬¬ä¸‰æ¡è·¯å¾„å®Œå…¨æ˜¯å…³äºŽé˜²å¾¡ã€‚è¿™å°±æ˜¯STç­–ç•¥ï¼Œæ„æ€å°±æ˜¯åˆ©ç”¨ä½ çš„ç‹¬ç‰¹ä¼˜åŠ¿æ¥æŠµå¾¡é‚£äº›å¤–éƒ¨å¨èƒã€‚è¿™å…³ä¹ŽäºŽåœ¨ä½ çš„åŸŽå¸‚å‘¨å›´å»ºç«‹ä¸€æ¡ç«žäº‰æŠ¤åŸŽæ²³ã€‚ä½ å¦‚ä½•é˜»æ­¢å…¶ä»–åœ°æ–¹æŠ„è¢­ä½ ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ï¼‰ä½ å¿…é¡»åŠ å€æŠ•å…¥é‚£äº›æ— æ³•è¢«å¤åˆ¶çš„ä¸œè¥¿ã€‚"
          },
          {
            slide: 18,
            english: "This means you've got to shift the story you're telling. The 8D Magic City stuff looks cool sure, but other places can build futuristic stuff. What they can't copy is the deep ancient history of the Three Gorges. It also means making amazing service, like literally closing roads for tourists, a standard feature of the brand, not just a one-off viral stunt.",
            chinese: "è¿™æ„å‘³ç€ä½ å¿…é¡»è½¬å˜ä½ æ­£åœ¨è®²è¿°çš„æ•…äº‹ã€‚é‚£ä¸ª8Dé­”å¹»ä¹‹éƒ½çš„ä¸œè¥¿çœ‹èµ·æ¥å¾ˆé…·ã€‚å½“ç„¶ï¼Œå…¶ä»–åœ°æ–¹ä¹Ÿèƒ½å»ºé€ å……æ»¡æœªæ¥æ„Ÿçš„ä¸œè¥¿ã€‚ä½†ä»–ä»¬æ— æ³•å¤åˆ¶çš„ï¼Œæ˜¯ä¸‰å³¡æ·±åŽšçš„å¤è€åŽ†å²ã€‚è¿™ä¹Ÿæ„å‘³ç€ä½ è¦æŠŠä¼˜è´¨çš„æœåŠ¡â€”â€”æ¯”å¦‚çœŸæ­£åœ°ä¸ºæ¸¸å®¢å°è·¯â€”â€”å˜æˆä¸€ä¸ªå“ç‰Œçš„æ ‡å‡†ç‰¹è‰²ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€æ¬¡å¶ç„¶çš„ç—…æ¯’å¼å™±å¤´ã€‚"
          },
          {
            slide: 19,
            english: "And the last path, the WT strategy, this one is about changing the game entirely, it's about tackling your internal weaknesses, which are vulnerable to external threats by just pivoting to a whole new market.",
            chinese: "æœ€åŽä¸€æ¡è·¯å¾„ï¼ŒWTç­–ç•¥ã€‚è¿™ä¸€æ¡æ˜¯å…³äºŽå½»åº•æ”¹å˜æ¸¸æˆè§„åˆ™çš„ã€‚å®ƒæ˜¯å…³äºŽé€šè¿‡è½¬å‘ä¸€ä¸ªå…¨æ–°çš„å¸‚åœºï¼Œæ¥è§£å†³é‚£äº›å®¹æ˜“å—åˆ°å¤–éƒ¨å¨èƒæ”»å‡»çš„å†…éƒ¨å¼±ç‚¹ã€‚"
          },
          {
            slide: 20,
            english: "And this is that big pivot we saw earlier. It means you start shifting your marketing dollars away from the hyper-competitive domestic market, the Red Sea, and into the wide open blue ocean of international travelers, especially after 2025. And for that audience, you drop the internet famous angle. The new story is all about the grandeur of the Yangtze River civilization and the practicality of being a huge visa-free transit hub.",
            chinese: "è¿™å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°è¿‡çš„é‚£ä¸ªå¤§è½¬å‘ã€‚è¿™æ„å‘³ç€ä½ å¼€å§‹æŠŠä½ çš„è¥é”€èµ„é‡‘ä»Žé«˜åº¦ç«žäº‰çš„å›½å†…å¸‚åœºï¼Œä¹Ÿå°±æ˜¯çº¢æµ·ï¼Œè½¬ç§»å¼€ï¼ŒæŠ•å‘å›½é™…æ¸¸å®¢é‚£ç‰‡å¹¿é˜”çš„ã€å¼€æ”¾çš„è“æµ·ã€‚è€Œå¯¹è¿™éƒ¨åˆ†å—ä¼—ï¼Œä½ è¦æŠ›å¼ƒç½‘çº¢çš„é‚£ä¸ªè§’åº¦ã€‚æ–°çš„æ•…äº‹å°†å®Œå…¨æ˜¯å…³äºŽé•¿æ±Ÿæ–‡æ˜Žçš„å®ä¼Ÿå£®ä¸½ï¼Œä»¥åŠä½œä¸ºä¸€ä¸ªå·¨å¤§çš„å…ç­¾è¿‡å¢ƒæž¢çº½çš„å®žç”¨æ€§ã€‚"
          },
          {
            slide: 21,
            english: "So when you put all four of these strategies together, your offense, your turnaround, your defense, and your big pivot, the end goal is crystal clear. It's a full on plan to evolve from a passing social media trend into a truly timeless global destination. from Wang Hong to Chong Hong.",
            chinese: "æ‰€ä»¥ï¼Œå½“ä½ æŠŠæ‰€æœ‰è¿™å››ç§ç­–ç•¥â€”â€”ä½ çš„è¿›æ”»ã€ä½ çš„æ‰­è½¬ã€ä½ çš„é˜²å¾¡å’Œä½ çš„å¤§è½¬å‘â€”â€”ç»“åˆåœ¨ä¸€èµ·æ—¶ï¼Œæœ€ç»ˆç›®æ ‡å°±å˜å¾—æ— æ¯”æ¸…æ™°äº†ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨é¢çš„è®¡åˆ’ï¼Œæ—¨åœ¨ä»Žä¸€ä¸ªçŸ­æš‚æ˜“é€çš„ç¤¾äº¤åª’ä½“æ½®æµï¼Œè¿›åŒ–æˆä¸€ä¸ªçœŸæ­£æ°¸æ’çš„å…¨çƒç›®çš„åœ°ã€‚ä»Žç½‘çº¢å˜ä¸ºé•¿çº¢ã€‚"
          },
          {
            slide: 22,
            english: "So Chongqing has its playbook, it's a smart, clear path forward. But it kind of leaves us with a much bigger question, doesn't it? In an age where what we see and where we go is so heavily influenced by these mysterious algorithms, can any long-term plan really, truly outsmart the internet? That's something every city in the world has to be thinking about right now.",
            chinese: "æ‰€ä»¥ï¼Œé‡åº†æœ‰äº†å®ƒçš„æˆ˜ç•¥æ‰‹å†Œï¼Œè¿™æ˜¯ä¸€æ¡æ¸…æ™°ã€æ˜Žæ™ºçš„å‰è¿›ä¹‹è·¯ã€‚ä½†è¿™ä¼¼ä¹Žç»™æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªæ›´å¤§çš„é—®é¢˜ï¼Œä¸æ˜¯å—ï¼Ÿåœ¨è¿™ä¸ªæˆ‘ä»¬æ‰€è§å’Œæ‰€åŽ»ä¹‹å¤„éƒ½æ·±å—è¿™äº›ç¥žç§˜ç®—æ³•å·¨å¤§å½±å“çš„æ—¶ä»£ï¼ŒçœŸçš„æœ‰ä»»ä½•é•¿æœŸè®¡åˆ’ï¼Œèƒ½å¤ŸçœŸæ­£åœ°æ™ºèƒœäº’è”ç½‘å—ï¼Ÿè¿™æ˜¯å…¨ä¸–ç•Œæ¯ä¸ªåŸŽå¸‚çŽ°åœ¨éƒ½å¿…é¡»æ€è€ƒçš„é—®é¢˜ã€‚"
          }
        ];
        
        // Load the slides data
        const slides = [
            "slides/slide1.html", "slides/slide2.html", "slides/slide3.html", "slides/slide4.html", 
            "slides/slide5.html", "slides/slide6.html", "slides/slide7.html", "slides/slide8.html", 
            "slides/slide9.html", "slides/slide10.html", "slides/slide11.html", "slides/slide12.html", 
            "slides/slide13.html", "slides/slide14.html", "slides/slide15.html", "slides/slide16.html", 
            "slides/slide17.html", "slides/slide18.html", "slides/slide19.html", "slides/slide20.html", 
            "slides/slide21.html", "slides/slide22.html"
        ];

        // Audio files mapping
        const audioFiles = [
            "audio/slide1.mp3", "audio/slide2.mp3", "audio/slide3.mp3", "audio/slide4.mp3",
            "audio/slide5.mp3", "audio/slide6.mp3", "audio/slide7.mp3", "audio/slide8.mp3",
            "audio/slide9.mp3", "audio/slide10.mp3", "audio/slide11.mp3", "audio/slide12.mp3",
            "audio/slide13.mp3", "audio/slide14.mp3", "audio/slide15.mp3", "audio/slide16.mp3",
            "audio/slide17.mp3", "audio/slide18.mp3", "audio/slide19.mp3", "audio/slide20.mp3",
            "audio/slide21.mp3", "audio/slide22.mp3"
        ];

        let currentSlideIndex = 0;
        let viewMode = 'list';
        let isFullscreen = false;
        let controlsTimeout;
        
        // Audio state
        let currentAudio = null;
        let isPlaying = false;
        let currentSpeed = 1.0;
        let autoPlay = false;
        let isAutoPlayEnabled = false;
        
        // Subtitle state
        let subtitlesEnabled = false;
        let currentSubtitle = null;
        let subtitleHideTimeout;

        // DOM elements
        const previewContainer = document.getElementById('preview-container');
        const presentationMode = document.getElementById('presentation-mode');
        const presentationSlide = document.getElementById('presentation-slide');
        const playButton = document.getElementById('play-button');
        const prevButton = document.getElementById('prev-slide');
        const nextButton = document.getElementById('next-slide');
        const exitButton = document.getElementById('exit-presentation');
        const fullscreenToggle = document.getElementById('fullscreen-toggle');
        const progressFill = document.getElementById('progress-fill');
        const currentSlideElement = document.getElementById('current-slide');
        const totalSlidesElement = document.getElementById('total-slides');
        const gridViewBtn = document.getElementById('grid-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');

        // Unified control elements
        const unifiedControls = document.getElementById('unified-controls');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const audioProgress = document.getElementById('audio-progress');
        const audioProgressFill = document.getElementById('audio-progress-fill');
        const audioCurrentTime = document.getElementById('audio-current-time');
        const audioDuration = document.getElementById('audio-duration');
        const speedBtns = document.querySelectorAll('.speed-btn');
        
        // Subtitle elements
        const subtitleToggle = document.getElementById('subtitle-toggle');
        const subtitleContainer = document.getElementById('subtitle-container');
        const subtitleEnglish = document.getElementById('subtitle-english');
        const subtitleChinese = document.getElementById('subtitle-chinese');

        // Initialize the viewer
        function initViewer() {
            totalSlidesElement.textContent = slides.length;
            generatePreviews();
            setupViewModeButtons();
            setupAudioControls();
            
            // Wait for precise subtitle data to load
            waitForSubtitleData();
        }

        function waitForSubtitleData() {
            if (window.preciseSubtitleData) {
                console.log('Precise subtitle data loaded successfully');
                console.log('Available slides:', Object.keys(window.preciseSubtitleData));
                return;
            }
            
            // Check every 100ms for subtitle data
            const checkInterval = setInterval(() => {
                if (window.preciseSubtitleData) {
                    console.log('Precise subtitle data loaded successfully');
                    console.log('Available slides:', Object.keys(window.preciseSubtitleData));
                    clearInterval(checkInterval);
                }
            }, 100);
            
            // Timeout after 5 seconds
            setTimeout(() => {
                clearInterval(checkInterval);
                console.log('Using fallback subtitle data');
                console.log('Available fallback slides:', subtitleData.length);
            }, 5000);
        }

        // Generate slide previews
        function generatePreviews() {
            previewContainer.innerHTML = '';

            let loadedCount = 0;
            const totalSlides = slides.length;

            slides.forEach((slide, index) => {
                const slidePreview = document.createElement('div');
                slidePreview.className = 'slide-preview';
                if (index === currentSlideIndex) {
                    slidePreview.classList.add('active');
                }

                slidePreview.innerHTML = `
                    <div class="slide-number">${index + 1}</div>
                    <div class="slide-frame-container">
                        <iframe class="slide-frame" src="${slide}" frameborder="0"></iframe>
                        <div class="audio-indicator">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                            </svg>
                            Audio
                        </div>
                    </div>
                `;

                slidePreview.addEventListener('click', () => {
                    startPresentation(index);
                });

                // Wait for iframe to load before scaling
                const iframe = slidePreview.querySelector('.slide-frame');
                iframe.addEventListener('load', () => {
                    loadedCount++;
                    if (loadedCount === totalSlides) {
                        if (viewMode === 'grid') {
                            setTimeout(scaleGridPreviews, 100);
                        } else if (viewMode === 'list') {
                            setTimeout(scaleListPreviews, 100);
                        }
                    }
                });

                previewContainer.appendChild(slidePreview);
            });
        }

        // Setup view mode buttons
        function setupViewModeButtons() {
            gridViewBtn.addEventListener('click', () => setViewMode('grid'));
            listViewBtn.addEventListener('click', () => setViewMode('list'));
        }

        // Setup audio controls
        function setupAudioControls() {
            playPauseBtn.addEventListener('click', toggleAudio);
            audioProgress.addEventListener('click', seekAudio);
            
            speedBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    speedBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSpeed = parseFloat(btn.dataset.speed);
                    if (currentAudio) {
                        currentAudio.playbackRate = currentSpeed;
                    }
                });
            });
            
            // Setup subtitle controls
            subtitleToggle.addEventListener('click', toggleSubtitles);
        }

        // Set view mode
        function setViewMode(mode) {
            viewMode = mode;
            if (mode === 'grid') {
                previewContainer.classList.remove('list-view');
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                setTimeout(scaleGridPreviews, 100);
            } else {
                previewContainer.classList.add('list-view');
                gridViewBtn.classList.remove('active');
                listViewBtn.classList.add('active');
                setTimeout(scaleListPreviews, 100);
            }
        }

        // Scale list previews
        function scaleListPreviews() {
            if (viewMode !== 'list') return;
            const slidePreviews = document.querySelectorAll('.preview-container.list-view .slide-preview');
            slidePreviews.forEach(preview => {
                const frame = preview.querySelector('.slide-frame');
                if (!frame) return;
                const container = frame.closest('.slide-frame-container');
                const containerWidth = container.clientWidth;
                const scale = containerWidth / 1280;
                frame.style.transform = `scale(${scale})`;
            });
        }

        // Scale grid previews
        function scaleGridPreviews() {
            if (viewMode !== 'grid') return;
            const slidePreviews = document.querySelectorAll('.preview-container.grid-view .slide-preview');
            slidePreviews.forEach(preview => {
                const frame = preview.querySelector('.slide-frame');
                if (!frame) return;
                const container = frame.closest('.slide-frame-container');
                const containerWidth = container.clientWidth;
                const scale = containerWidth / 1280;
                frame.style.transform = `scale(${scale})`;
            });
        }

        // Start presentation with auto-play
        function startPresentation(slideIndex = 0) {
            currentSlideIndex = slideIndex;
            isAutoPlayEnabled = true;
            presentationMode.style.display = 'flex';
            updateSlide();
            loadCurrentAudio();
            
            // Add fullscreen class to unified controls
            unifiedControls.classList.add('fullscreen');
            
            // Start auto-play after a short delay to ensure audio is loaded
            setTimeout(() => {
                if (isAutoPlayEnabled) {
                    toggleAudio();
                }
            }, 1000);
        }

        // Exit presentation
        function exitPresentation() {
            stopAudio();
            isAutoPlayEnabled = false;
            presentationMode.style.display = 'none';
            unifiedControls.classList.remove('fullscreen');
        }

        // Update slide
        function updateSlide() {
            presentationSlide.src = slides[currentSlideIndex];
            currentSlideElement.textContent = currentSlideIndex + 1;
            
            // Update progress
            const progress = ((currentSlideIndex + 1) / slides.length) * 100;
            progressFill.style.width = `${progress}%`;
            
            // Update preview highlighting
            document.querySelectorAll('.slide-preview').forEach((preview, index) => {
                if (index === currentSlideIndex) {
                    preview.classList.add('active');
                } else {
                    preview.classList.remove('active');
                }
            });
            
            // Clear current subtitle when switching slides
            hideSubtitles();
            currentSubtitle = null;
            
            // Update subtitle immediately if audio is playing
            if (subtitlesEnabled && currentAudio) {
                setTimeout(() => {
                    updateCurrentSubtitle();
                }, 100);
            }

            // Scale slide
            setTimeout(scalePresentationSlide, 100);
            
            // Load and sync audio
            loadCurrentAudio();
            updateAudioIndicator();
        }

        // Scale presentation slide
        function scalePresentationSlide() {
            const container = document.querySelector('.presentation-slide-container');
            const containerWidth = container.clientWidth - 40;
            const containerHeight = container.clientHeight - 40;

            if (isFullscreen) {
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight - 160; // Account for both controls height (80px + 80px)
                const scaleX = viewportWidth / 1280;
                const scaleY = viewportHeight / 720;
                const scale = Math.min(scaleX, scaleY);
                presentationSlide.style.transform = `scale(${scale})`;
            } else {
                const scaleX = containerWidth / 1280;
                const scaleY = containerHeight / 720;
                const scale = Math.min(scaleX, scaleY);
                presentationSlide.style.transform = `scale(${scale})`;
            }
        }

        // Audio functions
        function loadCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            const audioSrc = audioFiles[currentSlideIndex];
            if (audioSrc) {
                currentAudio = new Audio(audioSrc);
                currentAudio.playbackRate = currentSpeed;
                
                currentAudio.addEventListener('loadedmetadata', () => {
                    audioDuration.textContent = formatTime(currentAudio.duration);
                });

                currentAudio.addEventListener('timeupdate', updateAudioProgress);
                currentAudio.addEventListener('ended', onAudioEnded);
                currentAudio.addEventListener('error', (e) => {
                    console.warn('Audio loading error:', e);
                });
            }
        }

        function toggleAudio() {
            if (!currentAudio) return;

            if (isPlaying) {
                currentAudio.pause();
                playPauseBtn.innerHTML = 'â–¶';
                isPlaying = false;
            } else {
                currentAudio.play().then(() => {
                    playPauseBtn.innerHTML = 'â¸';
                    isPlaying = true;
                }).catch(e => {
                    console.warn('Audio play failed:', e);
                });
            }
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            playPauseBtn.innerHTML = 'â–¶';
            isPlaying = false;
        }

        function updateAudioProgress() {
            if (!currentAudio) return;
            
            const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
            audioProgressFill.style.width = `${progress}%`;
            audioCurrentTime.textContent = formatTime(currentAudio.currentTime);
            
            // Update subtitles
            updateCurrentSubtitle();
        }

        function seekAudio(e) {
            if (!currentAudio) return;
            
            const rect = audioProgress.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            currentAudio.currentTime = percent * currentAudio.duration;
        }

        function onAudioEnded() {
            playPauseBtn.innerHTML = 'â–¶';
            isPlaying = false;
            
            // Auto advance to next slide if auto-play is enabled
            if (isAutoPlayEnabled && currentSlideIndex < slides.length - 1) {
                setTimeout(() => {
                    nextSlide();
                    if (isAutoPlayEnabled) {
                        setTimeout(() => {
                            toggleAudio();
                        }, 500);
                    }
                }, 1000);
            }
        }

        function updateAudioIndicator() {
            // Update audio indicator on current slide preview
            document.querySelectorAll('.slide-preview').forEach((preview, index) => {
                const indicator = preview.querySelector('.audio-indicator');
                if (index === currentSlideIndex) {
                    indicator.classList.add('playing');
                } else {
                    indicator.classList.remove('playing');
                }
            });
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Subtitle functions
        function toggleSubtitles() {
            subtitlesEnabled = !subtitlesEnabled;
            subtitleToggle.classList.toggle('active', subtitlesEnabled);
            subtitleToggle.textContent = subtitlesEnabled ? 'ðŸŽ¬ Hide Subtitles' : 'ðŸŽ¬ Subtitles';
            
            if (!subtitlesEnabled) {
                hideSubtitles();
            } else {
                updateCurrentSubtitle();
            }
        }

        function updateCurrentSubtitle() {
            if (!subtitlesEnabled || !currentAudio) return;
            
            const currentTime = currentAudio.currentTime;
            const subtitle = getCurrentSubtitle(currentSlideIndex, currentTime);
            
            if (subtitle && subtitle !== currentSubtitle) {
                displaySubtitle(subtitle);
                currentSubtitle = subtitle;
            }
        }

        function getCurrentSubtitle(slideIndex, currentTime) {
            // Use precise subtitle data if available
            const slideSubtitles = window.preciseSubtitleData && window.preciseSubtitleData[slideIndex.toString()];
            if (slideSubtitles && Array.isArray(slideSubtitles)) {
                // Find the current subtitle based on precise time stamps
                for (let subtitle of slideSubtitles) {
                    const startTime = parseTimeToSeconds(subtitle.start);
                    const endTime = parseTimeToSeconds(subtitle.end);
                    
                    if (currentTime >= startTime && currentTime < endTime) {
                        return subtitle;
                    }
                }
                return null;
            }
            
            // Fallback to original data structure
            const slideSubtitle = subtitleData[slideIndex];
            if (!slideSubtitle) return null;
            
            // Estimate timing based on audio length (fallback approach)
            const estimatedDuration = 20; // Average 20 seconds per slide
            const slideStartTime = slideIndex * estimatedDuration;
            const slideEndTime = (slideIndex + 1) * estimatedDuration;
            
            if (currentTime >= slideStartTime && currentTime < slideEndTime) {
                return slideSubtitle;
            }
            
            return null;
        }

        function parseTimeToSeconds(timeStr) {
            // Convert "HH:MM:SS,mmm" to seconds
            const parts = timeStr.split(':');
            const hours = parseInt(parts[0]);
            const minutes = parseInt(parts[1]);
            const secondsAndMs = parts[2].split(',');
            const seconds = parseInt(secondsAndMs[0]);
            const milliseconds = parseInt(secondsAndMs[1]);
            
            return hours * 3600 + minutes * 60 + seconds + milliseconds / 1000;
        }

        function displaySubtitle(subtitle) {
            if (!subtitlesEnabled) return;
            
            clearTimeout(subtitleHideTimeout);
            
            // Remove fade-out class if present
            subtitleContainer.classList.remove('fade-out');
            
            subtitleEnglish.textContent = subtitle.english;
            subtitleChinese.textContent = subtitle.chinese;
            subtitleContainer.classList.add('show');
            
            // Auto hide when subtitle ends (for precise subtitles) or after 5 seconds
            const startTime = parseTimeToSeconds(subtitle.start);
            const endTime = parseTimeToSeconds(subtitle.end);
            const remainingTime = (endTime - parseTimeToSeconds(subtitle.end) + endTime - startTime) * 1000;
            
            subtitleHideTimeout = setTimeout(() => {
                hideSubtitles();
            }, Math.min(remainingTime, 5000));
        }

        function hideSubtitles() {
            subtitleContainer.classList.add('fade-out');
            subtitleContainer.classList.remove('show');
            clearTimeout(subtitleHideTimeout);
            currentSubtitle = null;
            
            // Remove fade-out class after animation completes
            setTimeout(() => {
                subtitleContainer.classList.remove('fade-out');
            }, 400);
        }

        // Navigation functions
        function nextSlide() {
            if (currentSlideIndex < slides.length - 1) {
                currentSlideIndex++;
                updateSlide();
            }
        }

        function prevSlide() {
            if (currentSlideIndex > 0) {
                currentSlideIndex--;
                updateSlide();
            }
        }

        // Fullscreen functions
        function toggleFullscreen() {
            if (!isFullscreen) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            const element = presentationMode;
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if (element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if (element.msRequestFullscreen) {
                element.msRequestFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        function handleFullscreenChange() {
            isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                             document.mozFullScreenElement || document.msFullscreenElement);
            scalePresentationSlide();
        }

        function showControlsTemporarily() {
            unifiedControls.classList.add('show');
            
            clearTimeout(controlsTimeout);
            controlsTimeout = setTimeout(() => {
                unifiedControls.classList.remove('show');
            }, 3000);
        }

        // Event listeners
        playButton.addEventListener('click', () => startPresentation(0));
        prevButton.addEventListener('click', () => {
            prevSlide();
            showControlsTemporarily();
        });
        nextButton.addEventListener('click', () => {
            nextSlide();
            showControlsTemporarily();
        });
        exitButton.addEventListener('click', exitPresentation);
        fullscreenToggle.addEventListener('click', () => {
            toggleFullscreen();
            showControlsTemporarily();
        });

        // Fullscreen change listeners
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);

        // Mouse movement in fullscreen mode
        presentationMode.addEventListener('mousemove', showControlsTemporarily);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (presentationMode.style.display === 'flex') {
                if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'n') {
                    nextSlide();
                    showControlsTemporarily();
                } else if (e.key === 'ArrowLeft' || e.key === 'p') {
                    prevSlide();
                    showControlsTemporarily();
                } else if (e.key === 'Escape') {
                    if (isFullscreen) {
                        exitFullscreen();
                    } else {
                        exitPresentation();
                    }
                } else if (e.key === 'f' || e.key === 'F') {
                    toggleFullscreen();
                    showControlsTemporarily();
                } else if (e.key === ' ' || e.key === 'k') {
                    e.preventDefault();
                    toggleAudio();
                    showControlsTemporarily();
                }
            }
        });

        // Initialize when page loads
        window.addEventListener('load', initViewer);

        // Handle window resize
        window.addEventListener('resize', () => {
            if (presentationMode.style.display === 'flex') {
                scalePresentationSlide();
            }
            if (viewMode === 'grid') {
                scaleGridPreviews();
            } else if (viewMode === 'list') {
                scaleListPreviews();
            }
        });
    </script>
</body>
</html>
